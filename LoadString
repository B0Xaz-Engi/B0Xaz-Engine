-- bxScript UI Library - Enhanced Rayfield-Style Edition
-- Smooth animations, multi-platform support, optimized performance
-- Compatible with PC, Mobile, and Controller

local bxScript = {}
bxScript.__index = bxScript

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local GuiService = game:GetService("GuiService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Safe function wrappers for exploit compatibility
local function safeCall(func, ...)
    local success, result = pcall(func, ...)
    return success and result or nil
end

local makefolder = makefolder or function() end
local isfolder = isfolder or function() return false end
local writefile = writefile or function() end
local readfile = readfile or function() return "" end
local isfile = isfile or function() return false end
local setclipboard = setclipboard or function() end

-- Detect platform
local function detectPlatform()
    if UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled then
        return "Mobile"
    elseif UserInputService.GamepadEnabled then
        return "Console"
    else
        return "PC"
    end
end

local CurrentPlatform = detectPlatform()

-- Enhanced Theme Collection with smoother gradients
local Themes = {
    Dark = {
        Background = Color3.fromRGB(25, 25, 25),
        Secondary = Color3.fromRGB(35, 35, 35),
        Tertiary = Color3.fromRGB(45, 45, 45),
        Text = Color3.fromRGB(255, 255, 255),
        Accent = Color3.fromRGB(0, 170, 255),
        AccentGradient = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 200, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 140, 255))
        },
        Hover = Color3.fromRGB(55, 55, 55),
        Disabled = Color3.fromRGB(100, 100, 100),
        Error = Color3.fromRGB(255, 0, 0),
        Success = Color3.fromRGB(0, 255, 0),
        Warning = Color3.fromRGB(255, 165, 0),
    },
    Light = {
        Background = Color3.fromRGB(255, 255, 255),
        Secondary = Color3.fromRGB(240, 240, 240),
        Tertiary = Color3.fromRGB(220, 220, 220),
        Text = Color3.fromRGB(0, 0, 0),
        Accent = Color3.fromRGB(0, 120, 215),
        AccentGradient = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 150, 245)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 100, 185))
        },
        Hover = Color3.fromRGB(200, 200, 200),
        Disabled = Color3.fromRGB(150, 150, 150),
        Error = Color3.fromRGB(200, 0, 0),
        Success = Color3.fromRGB(0, 200, 0),
        Warning = Color3.fromRGB(200, 120, 0),
    },
    Ocean = {
        Background = Color3.fromRGB(15, 30, 45),
        Secondary = Color3.fromRGB(25, 40, 55),
        Tertiary = Color3.fromRGB(35, 50, 65),
        Text = Color3.fromRGB(255, 255, 255),
        Accent = Color3.fromRGB(0, 200, 255),
        AccentGradient = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 220, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 180, 255))
        },
        Hover = Color3.fromRGB(45, 60, 75),
        Disabled = Color3.fromRGB(80, 95, 110),
        Error = Color3.fromRGB(255, 80, 80),
        Success = Color3.fromRGB(80, 255, 150),
        Warning = Color3.fromRGB(255, 200, 80),
    },
    Sunset = {
        Background = Color3.fromRGB(40, 20, 30),
        Secondary = Color3.fromRGB(50, 30, 40),
        Tertiary = Color3.fromRGB(60, 40, 50),
        Text = Color3.fromRGB(255, 240, 230),
        Accent = Color3.fromRGB(255, 120, 150),
        AccentGradient = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 170)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 100, 130))
        },
        Hover = Color3.fromRGB(70, 50, 60),
        Disabled = Color3.fromRGB(100, 80, 90),
        Error = Color3.fromRGB(255, 100, 100),
        Success = Color3.fromRGB(150, 255, 180),
        Warning = Color3.fromRGB(255, 180, 100),
    },
    Midnight = {
        Background = Color3.fromRGB(10, 10, 25),
        Secondary = Color3.fromRGB(20, 20, 40),
        Tertiary = Color3.fromRGB(30, 30, 55),
        Text = Color3.fromRGB(200, 200, 255),
        Accent = Color3.fromRGB(100, 100, 255),
        AccentGradient = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(120, 120, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(80, 80, 255))
        },
        Hover = Color3.fromRGB(40, 40, 70),
        Disabled = Color3.fromRGB(60, 60, 90),
        Error = Color3.fromRGB(255, 80, 120),
        Success = Color3.fromRGB(120, 255, 200),
        Warning = Color3.fromRGB(255, 200, 120),
    },
    Neon = {
        Background = Color3.fromRGB(10, 10, 10),
        Secondary = Color3.fromRGB(20, 20, 20),
        Tertiary = Color3.fromRGB(30, 30, 30),
        Text = Color3.fromRGB(0, 255, 255),
        Accent = Color3.fromRGB(255, 0, 255),
        AccentGradient = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 200)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(200, 0, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 255))
        },
        Hover = Color3.fromRGB(40, 40, 40),
        Disabled = Color3.fromRGB(70, 70, 70),
        Error = Color3.fromRGB(255, 0, 100),
        Success = Color3.fromRGB(0, 255, 150),
        Warning = Color3.fromRGB(255, 255, 0),
    },
    Dracula = {
        Background = Color3.fromRGB(40, 42, 54),
        Secondary = Color3.fromRGB(68, 71, 90),
        Tertiary = Color3.fromRGB(98, 114, 164),
        Text = Color3.fromRGB(248, 248, 242),
        Accent = Color3.fromRGB(189, 147, 249),
        AccentGradient = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(209, 167, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(169, 127, 239))
        },
        Hover = Color3.fromRGB(75, 78, 102),
        Disabled = Color3.fromRGB(110, 115, 141),
        Error = Color3.fromRGB(255, 85, 85),
        Success = Color3.fromRGB(80, 250, 123),
        Warning = Color3.fromRGB(241, 250, 140),
    },
}

local CurrentTheme = Themes.Dark

-- Enhanced Icon Map
local IconMap = {
    ["home"] = "ðŸ ",
    ["settings"] = "âš™ï¸",
    ["user"] = "ðŸ‘¤",
    ["bell"] = "ðŸ””",
    ["search"] = "ðŸ”",
    ["info"] = "â„¹ï¸",
    ["warning"] = "âš ï¸",
    ["error"] = "âŒ",
    ["success"] = "âœ“",
    ["folder"] = "ðŸ“",
    ["file"] = "ðŸ“„",
    ["star"] = "â­",
    ["heart"] = "â¤ï¸",
    ["fire"] = "ðŸ”¥",
    ["lock"] = "ðŸ”’",
    ["unlock"] = "ðŸ”“",
    ["eye"] = "ðŸ‘ï¸",
    ["trash"] = "ðŸ—‘ï¸",
    ["copy"] = "ðŸ“‹",
    ["download"] = "â¬‡ï¸",
    ["upload"] = "â¬†ï¸",
    ["refresh"] = "ðŸ”„",
    ["plus"] = "âž•",
    ["minus"] = "âž–",
    ["check"] = "âœ”ï¸",
    ["close"] = "âœ–ï¸",
    ["menu"] = "â˜°",
    ["paint"] = "ðŸŽ¨",
    ["code"] = "ðŸ’»",
    ["game"] = "ðŸŽ®",
    ["rocket"] = "ðŸš€",
    ["shield"] = "ðŸ›¡ï¸",
    ["crown"] = "ðŸ‘‘",
    ["gem"] = "ðŸ’Ž",
}

local function GetIcon(iconName)
    return IconMap[iconName] or ""
end

-- Enhanced Animation Presets (Rayfield-style)
local AnimationPresets = {
    Fast = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    Medium = TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    Smooth = TweenInfo.new(0.35, Enum.EasingStyle.Sine, Enum.EasingDirection.Out),
    Bounce = TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
    Elastic = TweenInfo.new(0.5, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out),
}

-- Notification Queue System
local NotificationQueue = {}
local MaxNotifications = 5

-- Smooth Notification System
function bxScript:Notify(config)
    if #NotificationQueue >= MaxNotifications then
        local oldest = table.remove(NotificationQueue, 1)
        if oldest and oldest.Frame then
            TweenService:Create(oldest.Frame, AnimationPresets.Fast, {
                Position = UDim2.new(1, 340, oldest.Frame.Position.Y.Scale, oldest.Frame.Position.Y.Offset)
            }):Play()
            task.delay(0.2, function()
                oldest.Frame:Destroy()
            end)
        end
    end

    local notifData = {Frame = nil}
    table.insert(NotificationQueue, notifData)

    local notifType = config.Type or "info"
    local typeColors = {
        info = CurrentTheme.Accent,
        success = CurrentTheme.Success,
        warning = CurrentTheme.Warning,
        error = CurrentTheme.Error,
    }
    local typeColor = typeColors[notifType] or CurrentTheme.Accent

    local NotifyFrame = Instance.new("Frame")
    NotifyFrame.Size = UDim2.new(0, 0, 0, 0)
    NotifyFrame.Position = UDim2.new(1, 340, 1, -100 - (#NotificationQueue - 1) * 100)
    NotifyFrame.BackgroundColor3 = CurrentTheme.Secondary
    NotifyFrame.BorderSizePixel = 0
    NotifyFrame.Parent = self.ScreenGui
    NotifyFrame.ClipsDescendants = true
    NotifyFrame.ZIndex = 1000
    notifData.Frame = NotifyFrame

    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = NotifyFrame

    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = typeColor
    UIStroke.Thickness = 2
    UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    UIStroke.Parent = NotifyFrame

    -- Glow effect
    local Glow = Instance.new("ImageLabel")
    Glow.Size = UDim2.new(1, 30, 1, 30)
    Glow.Position = UDim2.new(0, -15, 0, -15)
    Glow.BackgroundTransparency = 1
    Glow.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
    Glow.ImageColor3 = typeColor
    Glow.ImageTransparency = 0.8
    Glow.ZIndex = NotifyFrame.ZIndex - 1
    Glow.Parent = NotifyFrame

    local AccentBar = Instance.new("Frame")
    AccentBar.Size = UDim2.new(0, 4, 1, 0)
    AccentBar.BackgroundColor3 = typeColor
    AccentBar.BorderSizePixel = 0
    AccentBar.Parent = NotifyFrame

    local BarGradient = Instance.new("UIGradient")
    BarGradient.Color = CurrentTheme.AccentGradient
    BarGradient.Rotation = 90
    BarGradient.Parent = AccentBar

    if config.Icon then
        local NIcon = Instance.new("TextLabel")
        NIcon.Size = UDim2.new(0, 40, 0, 40)
        NIcon.Position = UDim2.new(0, 15, 0, 10)
        NIcon.BackgroundTransparency = 1
        NIcon.Text = GetIcon(config.Icon)
        NIcon.TextColor3 = typeColor
        NIcon.Font = Enum.Font.SourceSansBold
        NIcon.TextSize = 24
        NIcon.Parent = NotifyFrame
    end

    local NTitle = Instance.new("TextLabel")
    NTitle.Size = UDim2.new(1, -70, 0, 25)
    NTitle.Position = UDim2.new(0, 60, 0, 8)
    NTitle.BackgroundTransparency = 1
    NTitle.Text = config.Title or "Notification"
    NTitle.TextColor3 = CurrentTheme.Text
    NTitle.Font = Enum.Font.GothamBold
    NTitle.TextSize = 16
    NTitle.TextXAlignment = Enum.TextXAlignment.Left
    NTitle.TextTransparency = 1
    NTitle.Parent = NotifyFrame

    local NContent = Instance.new("TextLabel")
    NContent.Size = UDim2.new(1, -70, 1, -35)
    NContent.Position = UDim2.new(0, 60, 0, 33)
    NContent.BackgroundTransparency = 1
    NContent.Text = config.Content or ""
    NContent.TextColor3 = CurrentTheme.Text
    NContent.Font = Enum.Font.Gotham
    NContent.TextSize = 14
    NContent.TextWrapped = true
    NContent.TextXAlignment = Enum.TextXAlignment.Left
    NContent.TextYAlignment = Enum.TextYAlignment.Top
    NContent.TextTransparency = 1
    NContent.Parent = NotifyFrame

    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Size = UDim2.new(0, 25, 0, 25)
    CloseBtn.Position = UDim2.new(1, -30, 0, 5)
    CloseBtn.BackgroundTransparency = 1
    CloseBtn.Text = "Ã—"
    CloseBtn.TextColor3 = CurrentTheme.Text
    CloseBtn.Font = Enum.Font.GothamBold
    CloseBtn.TextSize = 22
    CloseBtn.TextTransparency = 1
    CloseBtn.Parent = NotifyFrame
    
    CloseBtn.MouseButton1Click:Connect(function()
        TweenService:Create(NotifyFrame, AnimationPresets.Medium, {
            Position = UDim2.new(1, 340, NotifyFrame.Position.Y.Scale, NotifyFrame.Position.Y.Offset),
            Size = UDim2.new(0, 0, 0, 0)
        }):Play()
        task.wait(0.3)
        NotifyFrame:Destroy()
        for i, v in ipairs(NotificationQueue) do
            if v.Frame == NotifyFrame then
                table.remove(NotificationQueue, i)
                break
            end
        end
    end)

    -- Smooth entrance animation
    TweenService:Create(NotifyFrame, AnimationPresets.Bounce, {
        Size = UDim2.new(0, 320, 0, 90),
        Position = UDim2.new(1, -330, NotifyFrame.Position.Y.Scale, NotifyFrame.Position.Y.Offset)
    }):Play()
    
    task.wait(0.1)
    TweenService:Create(NTitle, AnimationPresets.Medium, {TextTransparency = 0}):Play()
    TweenService:Create(NContent, AnimationPresets.Medium, {TextTransparency = 0.2}):Play()
    TweenService:Create(CloseBtn, AnimationPresets.Medium, {TextTransparency = 0.3}):Play()

    task.spawn(function()
        task.wait(config.Duration or 5)
        if NotifyFrame.Parent then
            TweenService:Create(NotifyFrame, AnimationPresets.Medium, {
                Position = UDim2.new(1, 340, NotifyFrame.Position.Y.Scale, NotifyFrame.Position.Y.Offset),
                Size = UDim2.new(0, 0, 0, 0)
            }):Play()
            TweenService:Create(NTitle, AnimationPresets.Fast, {TextTransparency = 1}):Play()
            TweenService:Create(NContent, AnimationPresets.Fast, {TextTransparency = 1}):Play()
            task.wait(0.3)
            NotifyFrame:Destroy()
            for i, v in ipairs(NotificationQueue) do
                if v.Frame == NotifyFrame then
                    table.remove(NotificationQueue, i)
                    break
                end
            end
        end
    end)
end

-- Enhanced Prompt Dialog
function bxScript:Prompt(config)
    local Overlay = Instance.new("Frame")
    Overlay.Size = UDim2.new(1, 0, 1, 0)
    Overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    Overlay.BackgroundTransparency = 1
    Overlay.BorderSizePixel = 0
    Overlay.ZIndex = 999
    Overlay.Parent = self.ScreenGui

    local PromptFrame = Instance.new("Frame")
    PromptFrame.Size = UDim2.new(0, 0, 0, 0)
    PromptFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    PromptFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    PromptFrame.BackgroundColor3 = CurrentTheme.Background
    PromptFrame.BorderSizePixel = 0
    PromptFrame.ZIndex = 1000
    PromptFrame.Parent = Overlay
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 15)
    UICorner.Parent = PromptFrame

    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = CurrentTheme.Accent
    UIStroke.Thickness = 2
    UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    UIStroke.Parent = PromptFrame

    local PTitle = Instance.new("TextLabel")
    PTitle.Size = UDim2.new(1, -40, 0, 50)
    PTitle.Position = UDim2.new(0, 20, 0, 10)
    PTitle.BackgroundTransparency = 1
    PTitle.Text = config.Title or "Confirm"
    PTitle.TextColor3 = CurrentTheme.Text
    PTitle.Font = Enum.Font.GothamBold
    PTitle.TextSize = 20
    PTitle.TextXAlignment = Enum.TextXAlignment.Left
    PTitle.TextTransparency = 1
    PTitle.Parent = PromptFrame

    local PContent = Instance.new("TextLabel")
    PContent.Size = UDim2.new(1, -40, 0, 80)
    PContent.Position = UDim2.new(0, 20, 0, 60)
    PContent.BackgroundTransparency = 1
    PContent.Text = config.Content or "Are you sure?"
    PContent.TextColor3 = CurrentTheme.Text
    PContent.Font = Enum.Font.Gotham
    PContent.TextSize = 16
    PContent.TextWrapped = true
    PContent.TextXAlignment = Enum.TextXAlignment.Left
    PContent.TextYAlignment = Enum.TextYAlignment.Top
    PContent.TextTransparency = 1
    PContent.Parent = PromptFrame

    local ButtonFrame = Instance.new("Frame")
    ButtonFrame.Size = UDim2.new(1, -40, 0, 45)
    ButtonFrame.Position = UDim2.new(0, 20, 1, -55)
    ButtonFrame.BackgroundTransparency = 1
    ButtonFrame.Parent = PromptFrame

    local ConfirmBtn = Instance.new("TextButton")
    ConfirmBtn.Size = UDim2.new(0.48, 0, 1, 0)
    ConfirmBtn.Position = UDim2.new(0, 0, 0, 0)
    ConfirmBtn.BackgroundColor3 = CurrentTheme.Success
    ConfirmBtn.BorderSizePixel = 0
    ConfirmBtn.Text = config.ConfirmText or "Confirm"
    ConfirmBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    ConfirmBtn.Font = Enum.Font.GothamBold
    ConfirmBtn.TextSize = 16
    ConfirmBtn.AutoButtonColor = false
    ConfirmBtn.Parent = ButtonFrame

    local CCorner = Instance.new("UICorner")
    CCorner.CornerRadius = UDim.new(0, 8)
    CCorner.Parent = ConfirmBtn

    local CGradient = Instance.new("UIGradient")
    CGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, CurrentTheme.Success),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(
            math.clamp(CurrentTheme.Success.R * 255 - 20, 0, 255),
            math.clamp(CurrentTheme.Success.G * 255 - 20, 0, 255),
            math.clamp(CurrentTheme.Success.B * 255 - 20, 0, 255)
        ))
    }
    CGradient.Rotation = 90
    CGradient.Parent = ConfirmBtn

    local CancelBtn = Instance.new("TextButton")
    CancelBtn.Size = UDim2.new(0.48, 0, 1, 0)
    CancelBtn.Position = UDim2.new(0.52, 0, 0, 0)
    CancelBtn.BackgroundColor3 = CurrentTheme.Error
    CancelBtn.BorderSizePixel = 0
    CancelBtn.Text = config.CancelText or "Cancel"
    CancelBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    CancelBtn.Font = Enum.Font.GothamBold
    CancelBtn.TextSize = 16
    CancelBtn.AutoButtonColor = false
    CancelBtn.Parent = ButtonFrame

    local CanCorner = Instance.new("UICorner")
    CanCorner.CornerRadius = UDim.new(0, 8)
    CanCorner.Parent = CancelBtn

    local CanGradient = Instance.new("UIGradient")
    CanGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, CurrentTheme.Error),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(
            math.clamp(CurrentTheme.Error.R * 255 - 20, 0, 255),
            math.clamp(CurrentTheme.Error.G * 255 - 20, 0, 255),
            math.clamp(CurrentTheme.Error.B * 255 - 20, 0, 255)
        ))
    }
    CanGradient.Rotation = 90
    CanGradient.Parent = CancelBtn

    -- Hover effects
    ConfirmBtn.MouseEnter:Connect(function()
        TweenService:Create(ConfirmBtn, AnimationPresets.Fast, {
            Size = UDim2.new(0.48, 0, 1, 2)
        }):Play()
    end)
    ConfirmBtn.MouseLeave:Connect(function()
        TweenService:Create(ConfirmBtn, AnimationPresets.Fast, {
            Size = UDim2.new(0.48, 0, 1, 0)
        }):Play()
    end)

    CancelBtn.MouseEnter:Connect(function()
        TweenService:Create(CancelBtn, AnimationPresets.Fast, {
            Size = UDim2.new(0.48, 0, 1, 2)
        }):Play()
    end)
    CancelBtn.MouseLeave:Connect(function()
        TweenService:Create(CancelBtn, AnimationPresets.Fast, {
            Size = UDim2.new(0.48, 0, 1, 0)
        }):Play()
    end)

    local function closePrompt(result)
        TweenService:Create(PromptFrame, AnimationPresets.Medium, {
            Size = UDim2.new(0, 0, 0, 0)
        }):Play()
        TweenService:Create(Overlay, AnimationPresets.Medium, {
            BackgroundTransparency = 1
        }):Play()
        TweenService:Create(PTitle, AnimationPresets.Fast, {TextTransparency = 1}):Play()
        TweenService:Create(PContent, AnimationPresets.Fast, {TextTransparency = 1}):Play()
        task.wait(0.3)
        Overlay:Destroy()
        if config.Callback then
            pcall(config.Callback, result)
        end
    end

    ConfirmBtn.MouseButton1Click:Connect(function()
        closePrompt(true)
    end)

    CancelBtn.MouseButton1Click:Connect(function()
        closePrompt(false)
    end)

    -- Animations
    TweenService:Create(Overlay, AnimationPresets.Medium, {
        BackgroundTransparency = 0.5
    }):Play()
    
    TweenService:Create(PromptFrame, AnimationPresets.Bounce, {
        Size = UDim2.new(0, 420, 0, 220)
    }):Play()
    
    task.wait(0.2)
    TweenService:Create(PTitle, AnimationPresets.Medium, {TextTransparency = 0}):Play()
    TweenService:Create(PContent, AnimationPresets.Medium, {TextTransparency = 0.2}):Play()
end

-- Destroy
function bxScript:Destroy()
    if self.ScreenGui then
        self.ScreenGui:Destroy()
    end
    for _, conn in ipairs(self.Connections or {}) do
        pcall(function() conn:Disconnect() end)
    end
end

-- Enhanced Visibility Toggle
function bxScript:SetVisibility(state)
    self.Visible = state
    if self.MainFrame then
        if state then
            self.MainFrame.Visible = true
            TweenService:Create(self.MainFrame, AnimationPresets.Bounce, {
                Size = self.OriginalSize or UDim2.new(0, 700, 0, 500),
                Position = UDim2.new(0.5, -350, 0.5, -250)
            }):Play()
            TweenService:Create(self.MainFrame.UIStroke, AnimationPresets.Medium, {
                Transparency = 0
            }):Play()
        else
            TweenService:Create(self.MainFrame, AnimationPresets.Medium, {
                Size = UDim2.new(0, 0, 0, 0),
                Position = UDim2.new(0.5, 0, 0.5, 0)
            }):Play()
            TweenService:Create(self.MainFrame.UIStroke, AnimationPresets.Medium, {
                Transparency = 1
            }):Play()
            task.wait(0.3)
            self.MainFrame.Visible = false
        end
    end
end

function bxScript:IsVisible()
    return self.Visible
end

-- Set Theme with smooth transition
function bxScript:SetTheme(themeName)
    if Themes[themeName] then
        local oldTheme = CurrentTheme
        CurrentTheme = Themes[themeName]
        
        -- Animate theme change
        local elementsToUpdate = {
            {self.MainFrame, "BackgroundColor3", CurrentTheme.Background},
            {self.Topbar, "BackgroundColor3", CurrentTheme.Secondary},
            {self.TabList, "BackgroundColor3", CurrentTheme.Tertiary},
        }
        
        for _, data in ipairs(elementsToUpdate) do
            if data[1] then
                TweenService:Create(data[1], AnimationPresets.Smooth, {
                    [data[2]] = data[3]
                }):Play()
            end
        end
        
        -- Update stroke color
        if self.MainFrame and self.MainFrame:FindFirstChild("UIStroke") then
            TweenService:Create(self.MainFrame.UIStroke, AnimationPresets.Smooth, {
                Color = CurrentTheme.Accent
            }):Play()
        end
        
        -- Save theme preference
        if self.ConfigurationSaving.Enabled then
            self.Flags["__theme"] = themeName
            self:SaveConfig()
        end
        
        self:Notify({
            Title = "Theme Changed",
            Content = "Theme set to " .. themeName,
            Duration = 2,
            Icon = "paint",
            Type = "success"
        })
    end
end

-- Get list of available themes
function bxScript:GetThemes()
    local themeList = {}
    for name, _ in pairs(Themes) do
        table.insert(themeList, name)
    end
    table.sort(themeList)
    return themeList
end

-- Profile System
function bxScript:CreateProfile(profileName)
    if not self.ConfigurationSaving.Enabled then return false end
    
    local profileFolder = self.ConfigurationSaving.FolderName .. "/profiles"
    if not isfolder(profileFolder) then
        makefolder(profileFolder)
    end
    
    local profileFile = profileFolder .. "/" .. profileName .. ".json"
    writefile(profileFile, HttpService:JSONEncode(self.Flags))
    
    self:Notify({
        Title = "Profile Saved",
        Content = "Profile '" .. profileName .. "' has been saved",
        Duration = 3,
        Icon = "success",
        Type = "success"
    })
    
    return true
end

function bxScript:LoadProfile(profileName)
    if not self.ConfigurationSaving.Enabled then return false end
    
    local profileFile = self.ConfigurationSaving.FolderName .. "/profiles/" .. profileName .. ".json"
    
    if isfile(profileFile) then
        local success, loaded = pcall(function()
            return HttpService:JSONDecode(readfile(profileFile))
        end)
        
        if success and type(loaded) == "table" then
            self.Flags = loaded
            
            -- Reload theme if saved
            if loaded["__theme"] and Themes[loaded["__theme"]] then
                self:SetTheme(loaded["__theme"])
            end
            
            self:Notify({
                Title = "Profile Loaded",
                Content = "Profile '" .. profileName .. "' has been loaded",
                Duration = 3,
                Icon = "success",
                Type = "success"
            })
            
            return true
        end
    end
    
    return false
end

-- CreateWindow
function bxScript:CreateWindow(settings)
    local self = setmetatable({}, bxScript)
    self.Settings = settings or {}
    self.Name = settings.Name or "bxScript UI"
    self.LoadingTitle = settings.LoadingTitle or "Loading UI"
    self.LoadingSubtitle = settings.LoadingSubtitle or "Please wait..."
    self.ToggleUIKeybind = settings.ToggleUIKeybind or Enum.KeyCode.RightControl
    self.ConfigurationSaving = settings.ConfigurationSaving or {Enabled = false, FolderName = "bxScript", FileName = "config.json"}
    self.KeySystem = settings.KeySystem or false
    self.KeySettings = settings.KeySettings or {Key = {}, SaveKey = false}
    self.Discord = settings.Discord or {Enabled = false, Invite = "", RememberJoins = false}
    self.Tabs = {}
    self.Visible = true
    self.Flags = {}
    self.Connections = {}
    self.Size = settings.Size or {700, 500}
    self.OriginalSize = UDim2.new(0, self.Size[1], 0, self.Size[2])

    -- ScreenGui
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = "bxScriptUI"
    self.ScreenGui.ResetOnSpawn = false
    self.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    self.ScreenGui.DisplayOrder = 100
    
    -- Try CoreGui first, fallback to PlayerGui
    local success = pcall(function()
        self.ScreenGui.Parent = game:GetService("CoreGui")
    end)
    if not success then
        self.ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    end

    -- Loading Screen with enhanced animations
    if settings.ShowLoadingScreen ~= false then
        local LoadingFrame = Instance.new("Frame")
        LoadingFrame.Size = UDim2.new(0, 0, 0, 0)
        LoadingFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        LoadingFrame.AnchorPoint = Vector2.new(0.5, 0.5)
        LoadingFrame.BackgroundColor3 = CurrentTheme.Secondary
        LoadingFrame.BorderSizePixel = 0
        LoadingFrame.ZIndex = 10000
        LoadingFrame.Parent = self.ScreenGui
        
        local LoadCorner = Instance.new("UICorner")
        LoadCorner.CornerRadius = UDim.new(0, 15)
        LoadCorner.Parent = LoadingFrame
        
        local LoadStroke = Instance.new("UIStroke")
        LoadStroke.Color = CurrentTheme.Accent
        LoadStroke.Thickness = 2
        LoadStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        LoadStroke.Transparency = 1
        LoadStroke.Parent = LoadingFrame

        local LTitle = Instance.new("TextLabel")
        LTitle.Size = UDim2.new(1, -40, 0, 60)
        LTitle.Position = UDim2.new(0, 20, 0, 20)
        LTitle.BackgroundTransparency = 1
        LTitle.Text = self.LoadingTitle
        LTitle.TextColor3 = CurrentTheme.Text
        LTitle.Font = Enum.Font.GothamBold
        LTitle.TextSize = 28
        LTitle.TextTransparency = 1
        LTitle.Parent = LoadingFrame

        local LSubtitle = Instance.new("TextLabel")
        LSubtitle.Size = UDim2.new(1, -40, 0, 30)
        LSubtitle.Position = UDim2.new(0, 20, 0, 75)
        LSubtitle.BackgroundTransparency = 1
        LSubtitle.Text = self.LoadingSubtitle
        LSubtitle.TextColor3 = CurrentTheme.Text
        LSubtitle.TextTransparency = 1
        LSubtitle.Font = Enum.Font.Gotham
        LSubtitle.TextSize = 16
        LSubtitle.Parent = LoadingFrame

        -- Animated loading dots
        task.spawn(function()
            local dots = 0
            while LoadingFrame.Parent do
                dots = (dots % 3) + 1
                LSubtitle.Text = self.LoadingSubtitle .. string.rep(".", dots)
                task.wait(0.5)
            end
        end)

        local ProgressBG = Instance.new("Frame")
        ProgressBG.Size = UDim2.new(1, -40, 0, 8)
        ProgressBG.Position = UDim2.new(0, 20, 0, 130)
        ProgressBG.BackgroundColor3 = CurrentTheme.Tertiary
        ProgressBG.BorderSizePixel = 0
        ProgressBG.Parent = LoadingFrame
        
        local ProgressCorner = Instance.new("UICorner")
        ProgressCorner.CornerRadius = UDim.new(1, 0)
        ProgressCorner.Parent = ProgressBG

        local ProgressFill = Instance.new("Frame")
        ProgressFill.Size = UDim2.new(0, 0, 1, 0)
        ProgressFill.BackgroundColor3 = CurrentTheme.Accent
        ProgressFill.BorderSizePixel = 0
        ProgressFill.Parent = ProgressBG
        
        local FillCorner = Instance.new("UICorner")
        FillCorner.CornerRadius = UDim.new(1, 0)
        FillCorner.Parent = ProgressFill
        
        local FillGradient = Instance.new("UIGradient")
        FillGradient.Color = CurrentTheme.AccentGradient
        FillGradient.Rotation = 0
        FillGradient.Parent = ProgressFill

        local PercentLabel = Instance.new("TextLabel")
        PercentLabel.Size = UDim2.new(1, -40, 0, 25)
        PercentLabel.Position = UDim2.new(0, 20, 0, 150)
        PercentLabel.BackgroundTransparency = 1
        PercentLabel.Text = "0%"
        PercentLabel.TextColor3 = CurrentTheme.Accent
        PercentLabel.Font = Enum.Font.GothamBold
        PercentLabel.TextSize = 16
        PercentLabel.TextTransparency = 1
        PercentLabel.Parent = LoadingFrame

        -- Smooth entrance
        TweenService:Create(LoadingFrame, AnimationPresets.Bounce, {
            Size = UDim2.new(0, 450, 0, 200)
        }):Play()
        
        task.wait(0.2)
        TweenService:Create(LoadStroke, AnimationPresets.Medium, {Transparency = 0}):Play()
        TweenService:Create(LTitle, AnimationPresets.Medium, {TextTransparency = 0}):Play()
        TweenService:Create(LSubtitle, AnimationPresets.Medium, {TextTransparency = 0.3}):Play()
        TweenService:Create(PercentLabel, AnimationPresets.Medium, {TextTransparency = 0}):Play()
        
        -- Animate progress with gradient shimmer
        task.spawn(function()
            for offset = 0, 1, 0.02 do
                FillGradient.Offset = Vector2.new(offset, 0)
                task.wait(0.02)
            end
        end)

        for i = 0, 100, 2 do
            TweenService:Create(ProgressFill, AnimationPresets.Fast, {
                Size = UDim2.new(i/100, 0, 1, 0)
            }):Play()
            PercentLabel.Text = i .. "%"
            task.wait(0.025)
        end
        
        task.wait(0.3)
        
        -- Smooth exit
        TweenService:Create(LoadingFrame, AnimationPresets.Medium, {
            Size = UDim2.new(0, 0, 0, 0)
        }):Play()
        TweenService:Create(LTitle, AnimationPresets.Fast, {TextTransparency = 1}):Play()
        TweenService:Create(LSubtitle, AnimationPresets.Fast, {TextTransparency = 1}):Play()
        TweenService:Create(PercentLabel, AnimationPresets.Fast, {TextTransparency = 1}):Play()
        TweenService:Create(LoadStroke, AnimationPresets.Fast, {Transparency = 1}):Play()
        
        task.wait(0.3)
        LoadingFrame:Destroy()
    end

    -- Main Frame with enhanced design
    self.MainFrame = Instance.new("Frame")
    self.MainFrame.Size = UDim2.new(0, 0, 0, 0)
    self.MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    self.MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    self.MainFrame.BackgroundColor3 = CurrentTheme.Background
    self.MainFrame.BorderSizePixel = 0
    self.MainFrame.ClipsDescendants = true
    self.MainFrame.Parent = self.ScreenGui
    
    local MainCorner = Instance.new("UICorner")
    MainCorner.CornerRadius = UDim.new(0, 15)
    MainCorner.Parent = self.MainFrame
    
    local MainStroke = Instance.new("UIStroke")
    MainStroke.Color = CurrentTheme.Accent
    MainStroke.Thickness = 2
    MainStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    MainStroke.Transparency = 1
    MainStroke.Parent = self.MainFrame

    -- Smooth entrance
    TweenService:Create(self.MainFrame, AnimationPresets.Bounce, {
        Size = self.OriginalSize,
        Position = UDim2.new(0.5, 0, 0.5, 0)
    }):Play()
    TweenService:Create(MainStroke, AnimationPresets.Medium, {Transparency = 0}):Play()

    -- Enhanced Topbar with gradient
    self.Topbar = Instance.new("Frame")
    self.Topbar.Size = UDim2.new(1, 0, 0, 45)
    self.Topbar.BackgroundColor3 = CurrentTheme.Secondary
    self.Topbar.BorderSizePixel = 0
    self.Topbar.Parent = self.MainFrame
    
    local TopCorner = Instance.new("UICorner")
    TopCorner.CornerRadius = UDim.new(0, 15)
    TopCorner.Parent = self.Topbar

    local TopFix = Instance.new("Frame")
    TopFix.Size = UDim2.new(1, 0, 0, 15)
    TopFix.Position = UDim2.new(0, 0, 1, -15)
    TopFix.BackgroundColor3 = CurrentTheme.Secondary
    TopFix.BorderSizePixel = 0
    TopFix.Parent = self.Topbar

    local TopGradient = Instance.new("UIGradient")
    TopGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, CurrentTheme.Secondary),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(
            math.clamp(CurrentTheme.Secondary.R * 255 - 10, 0, 255),
            math.clamp(CurrentTheme.Secondary.G * 255 - 10, 0, 255),
            math.clamp(CurrentTheme.Secondary.B * 255 - 10, 0, 255)
        ))
    }
    TopGradient.Rotation = 90
    TopGradient.Parent = self.Topbar

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, -120, 1, 0)
    Title.Position = UDim2.new(0, 18, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "ðŸš€ " .. self.Name
    Title.TextColor3 = CurrentTheme.Text
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 19
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = self.Topbar

    -- Platform indicator
    local PlatformLabel = Instance.new("TextLabel")
    PlatformLabel.Size = UDim2.new(0, 80, 0, 20)
    PlatformLabel.Position = UDim2.new(0, 18, 0, 22)
    PlatformLabel.BackgroundTransparency = 1
    PlatformLabel.Text = "ðŸ“± " .. CurrentPlatform
    PlatformLabel.TextColor3 = CurrentTheme.Accent
    PlatformLabel.Font = Enum.Font.Gotham
    PlatformLabel.TextSize = 11
    PlatformLabel.TextXAlignment = Enum.TextXAlignment.Left
    PlatformLabel.TextTransparency = 0.5
    PlatformLabel.Parent = self.Topbar

    -- Enhanced control buttons
    local function createControlButton(position, text, color)
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(0, 35, 0, 35)
        button.Position = position
        button.BackgroundColor3 = CurrentTheme.Tertiary
        button.BorderSizePixel = 0
        button.Text = text
        button.TextColor3 = color or CurrentTheme.Text
        button.Font = Enum.Font.GothamBold
        button.TextSize = 18
        button.AutoButtonColor = false
        button.Parent = self.Topbar
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = button
        
        button.MouseEnter:Connect(function()
            TweenService:Create(button, AnimationPresets.Fast, {
                BackgroundColor3 = CurrentTheme.Hover,
                Size = UDim2.new(0, 37, 0, 37)
            }):Play()
        end)
        
        button.MouseLeave:Connect(function()
            TweenService:Create(button, AnimationPresets.Fast, {
                BackgroundColor3 = CurrentTheme.Tertiary,
                Size = UDim2.new(0, 35, 0, 35)
            }):Play()
        end)
        
        return button
    end

    local Minimize = createControlButton(UDim2.new(1, -75, 0, 5), "_")
    Minimize.MouseButton1Click:Connect(function()
        self:SetVisibility(false)
    end)

    local Close = createControlButton(UDim2.new(1, -37, 0, 5), "Ã—", CurrentTheme.Error)
    Close.MouseButton1Click:Connect(function()
        self:SetVisibility(not self.Visible)
    end)

    -- Enhanced Tab List
    self.TabList = Instance.new("ScrollingFrame")
    self.TabList.Size = UDim2.new(0, 190, 1, -45)
    self.TabList.Position = UDim2.new(0, 0, 0, 45)
    self.TabList.BackgroundColor3 = CurrentTheme.Tertiary
    self.TabList.BorderSizePixel = 0
    self.TabList.ScrollBarThickness = 4
    self.TabList.ScrollBarImageColor3 = CurrentTheme.Accent
    self.TabList.ScrollBarImageTransparency = 0.3
    self.TabList.CanvasSize = UDim2.new(0, 0, 0, 0)
    self.TabList.Parent = self.MainFrame

    local TabListLayout = Instance.new("UIListLayout")
    TabListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    TabListLayout.Padding = UDim.new(0, 6)
    TabListLayout.Parent = self.TabList
    
    local TabPadding = Instance.new("UIPadding")
    TabPadding.PaddingTop = UDim.new(0, 10)
    TabPadding.PaddingBottom = UDim.new(0, 10)
    TabPadding.PaddingLeft = UDim.new(0, 10)
    TabPadding.PaddingRight = UDim.new(0, 10)
    TabPadding.Parent = self.TabList

    TabListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        self.TabList.CanvasSize = UDim2.new(0, 0, 0, TabListLayout.AbsoluteContentSize.Y + 20)
    end)

    -- Content Frame
    self.ContentFrame = Instance.new("Frame")
    self.ContentFrame.Size = UDim2.new(1, -190, 1, -45)
    self.ContentFrame.Position = UDim2.new(0, 190, 0, 45)
    self.ContentFrame.BackgroundTransparency = 1
    self.ContentFrame.Parent = self.MainFrame

    -- Enhanced Dragging System (works on all platforms)
    local dragging = false
    local dragInput, dragStart, startPos
    
    local function update(input)
        local delta = input.Position - dragStart
        TweenService:Create(self.MainFrame, TweenInfo.new(0.1, Enum.EasingStyle.Linear), {
            Position = UDim2.new(
                startPos.X.Scale, 
                startPos.X.Offset + delta.X, 
                startPos.Y.Scale, 
                startPos.Y.Offset + delta.Y
            )
        }):Play()
    end
    
    self.Topbar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = self.MainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    self.Topbar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            update(input)
        end
    end)

    -- Multi-Platform Toggle Support
    local toggleConn = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        -- Keyboard
        if input.KeyCode == self.ToggleUIKeybind then
            self:SetVisibility(not self.Visible)
        end
        
        -- Controller (Right Bumper + Y)
        if input.KeyCode == Enum.KeyCode.ButtonY and UserInputService:IsGamepadButtonDown(Enum.UserInputType.Gamepad1, Enum.KeyCode.ButtonR1) then
            self:SetVisibility(not self.Visible)
        end
    end)
    table.insert(self.Connections, toggleConn)

    -- Controller navigation hint
    if CurrentPlatform == "Console" then
        local ControllerHint = Instance.new("TextLabel")
        ControllerHint.Size = UDim2.new(1, -20, 0, 20)
        ControllerHint.Position = UDim2.new(0, 10, 1, -25)
        ControllerHint.BackgroundTransparency = 1
        ControllerHint.Text = "ðŸŽ® RB + Y to toggle UI"
        ControllerHint.TextColor3 = CurrentTheme.Accent
        ControllerHint.Font = Enum.Font.Gotham
        ControllerHint.TextSize = 11
        ControllerHint.TextTransparency = 0.5
        ControllerHint.Parent = self.MainFrame
    end

    -- Load Config
    if self.ConfigurationSaving.Enabled then
        local folder = self.ConfigurationSaving.FolderName
        if not isfolder(folder) then
            makefolder(folder)
        end
        local file = folder .. "/" .. self.ConfigurationSaving.FileName
        if isfile(file) then
            local success, loaded = pcall(function()
                return HttpService:JSONDecode(readfile(file))
            end)
            if success and type(loaded) == "table" then
                self.Flags = loaded
                
                if loaded["__theme"] and Themes[loaded["__theme"]] then
                    CurrentTheme = Themes[loaded["__theme"]]
                end
            end
        end
    end

    return self
end

-- Enhanced SelectTab with smooth animations
function bxScript:SelectTab(tab)
    for _, t in ipairs(self.Tabs) do
        if t.Content then
            t.Content.Visible = false
        end
        if t.Button then
            TweenService:Create(t.Button, AnimationPresets.Medium, {
                BackgroundColor3 = CurrentTheme.Tertiary,
                Size = UDim2.new(1, -10, 0, 42)
            }):Play()
            TweenService:Create(t.Button.TextLabel, AnimationPresets.Medium, {
                TextColor3 = CurrentTheme.Text,
                TextTransparency = 0.3
            }):Play()
            if t.Button:FindFirstChild("Indicator") then
                TweenService:Create(t.Button.Indicator, AnimationPresets.Fast, {
                    Size = UDim2.new(0, 0, 0, 42)
                }):Play()
            end
        end
    end
    
    if tab.Content then
        tab.Content.Visible = true
    end
    
    if tab.Button then
        TweenService:Create(tab.Button, AnimationPresets.Medium, {
            BackgroundColor3 = CurrentTheme.Accent,
            Size = UDim2.new(1, -8, 0, 44)
        }):Play()
        TweenService:Create(tab.Button.TextLabel, AnimationPresets.Medium, {
            TextColor3 = Color3.fromRGB(255, 255, 255),
            TextTransparency = 0
        }):Play()
        if tab.Button:FindFirstChild("Indicator") then
            TweenService:Create(tab.Button.Indicator, AnimationPresets.Fast, {
                Size = UDim2.new(0, 4, 0, 42)
            }):Play()
        end
    end
end

-- Enhanced CreateTab
function bxScript:CreateTab(name, icon)
    local Tab = {}
    Tab.Window = Self
    Tab.Name = name
    Tab.Icon = icon
    Tab.Elements = {}

    Tab.Button = Instance.new("TextButton")
    Tab.Button.Size = UDim2.new(1, -10, 0, 42)
    Tab.Button.BackgroundColor3 = CurrentTheme.Tertiary
    Tab.Button.BorderSizePixel = 0
    Tab.Button.Text = ""
    Tab.Button.AutoButtonColor = false
    Tab.Button.Parent = self.TabList
    
    local BtnCorner = Instance.new("UICorner")
    BtnCorner.CornerRadius = UDim.new(0, 10)
    BtnCorner.Parent = Tab.Button

    -- Gradient overlay
    local BtnGradient = Instance.new("UIGradient")
    BtnGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
    }
    BtnGradient.Transparency = NumberSequence.new{
        NumberSequenceKeypoint.new(0, 0.95),
        NumberSequenceKeypoint.new(1, 1)
    }
    BtnGradient.Rotation = 90
    BtnGradient.Parent = Tab.Button

    -- Selection indicator
    local Indicator = Instance.new("Frame")
    Indicator.Name = "Indicator"
    Indicator.Size = UDim2.new(0, 0, 0, 42)
    Indicator.Position = UDim2.new(0, 0, 0, 0)
    Indicator.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Indicator.BorderSizePixel = 0
    Indicator.Parent = Tab.Button
    
    local IndCorner = Instance.new("UICorner")
    IndCorner.CornerRadius = UDim.new(0, 10)
    IndCorner.Parent = Indicator

    Tab.TextLabel = Instance.new("TextLabel")
    TextLabel.Size = UDim2.new(1, -20, 1, 0)
    TextLabel.Position = UDim2.new(0, 10, 0, 0)
    TextLabel.BackgroundTransparency = 1
    TextLabel.Text = (icon and GetIcon(icon) .. "  " or "") .. name
    TextLabel.TextColor3 = CurrentTheme.Text
    TextLabel.TextTransparency = 0.3
    TextLabel.Font = Enum.Font.GothamBold
    TextLabel.TextSize = 15
    TextLabel.TextXAlignment = Enum.TextXAlignment.Left
    TextLabel.Parent = Tab.Button
    
    Tab.Button.TextLabel = TextLabel
    
    Tab.Button.MouseEnter:Connect(function()
        if Tab.Content and not Tab.Content.Visible then
            TweenService:Create(Tab.Button, AnimationPresets.Fast, {
                BackgroundColor3 = CurrentTheme.Hover,
                Size = UDim2.new(1, -8, 0, 44)
            }):Play()
            TweenService:Create(TextLabel, AnimationPresets.Fast, {
                TextTransparency = 0
            }):Play()
        end
    end)
    
    Tab.Button.MouseLeave:Connect(function()
        if Tab.Content and not Tab.Content.Visible then
            TweenService:Create(Tab.Button, AnimationPresets.Fast, {
                BackgroundColor3 = CurrentTheme.Tertiary,
                Size = UDim2.new(1, -10, 0, 42)
            }):Play()
            TweenService:Create(TextLabel, AnimationPresets.Fast, {
                TextTransparency = 0.3
            }):Play()
        end
    end)
    
    Tab.Button.MouseButton1Click:Connect(function()
        -- Button press animation
        TweenService:Create(Tab.Button, TweenInfo.new(0.1), {
            Size = UDim2.new(1, -12, 0, 40)
        }):Play()
        task.wait(0.1)
        self:SelectTab(Tab)
    end)

    -- Enhanced Content Frame
    Tab.Content = Instance.new("ScrollingFrame")
    Tab.Content.Size = UDim2.new(1, -10, 1, -10)
    Tab.Content.Position = UDim2.new(0, 5, 0, 5)
    Tab.Content.BackgroundTransparency = 1
    Tab.Content.ScrollBarThickness = 5
    Tab.Content.ScrollBarImageColor3 = CurrentTheme.Accent
    Tab.Content.ScrollBarImageTransparency = 0.3
    Tab.Content.BorderSizePixel = 0
    Tab.Content.Visible = false
    Tab.Content.CanvasSize = UDim2.new(0, 0, 0, 0)
    Tab.Content.Parent = self.ContentFrame

    local ContentLayout = Instance.new("UIListLayout")
    ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder
    ContentLayout.Padding = UDim.new(0, 12)
    ContentLayout.Parent = Tab.Content
    
    local ContentPadding = Instance.new("UIPadding")
    ContentPadding.PaddingTop = UDim.new(0, 12)
    ContentPadding.PaddingBottom = UDim.new(0, 12)
    ContentPadding.PaddingLeft = UDim.new(0, 12)
    ContentPadding.PaddingRight = UDim.new(0, 12)
    ContentPadding.Parent = Tab.Content
    
    ContentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        Tab.Content.CanvasSize = UDim2.new(0, 0, 0, ContentLayout.AbsoluteContentSize.Y + 24)
    end)

    table.insert(self.Tabs, Tab)
    
    if #self.Tabs == 1 then
        task.wait(0.1)
        self:SelectTab(Tab)
    end

    -- Enhanced CreateSection
    function Tab:CreateSection(name)
        local Section = Instance.new("Frame")
        Section.Size = UDim2.new(1, -10, 0, 0)
        Section.BackgroundColor3 = CurrentTheme.Secondary
        Section.BorderSizePixel = 0
        Section.AutomaticSize = Enum.AutomaticSize.Y
        Section.Parent = Tab.Content
        
        local SectionCorner = Instance.new("UICorner")
        SectionCorner.CornerRadius = UDim.new(0, 12)
        SectionCorner.Parent = Section

        local SectionGradient = Instance.new("UIGradient")
        SectionGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, CurrentTheme.Secondary),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(
                math.clamp(CurrentTheme.Secondary.R * 255 - 5, 0, 255),
                math.clamp(CurrentTheme.Secondary.G * 255 - 5, 0, 255),
                math.clamp(CurrentTheme.Secondary.B * 255 - 5, 0, 255)
            ))
        }
        SectionGradient.Rotation = 90
        SectionGradient.Parent = Section

        local STitle = Instance.new("TextLabel")
        STitle.Size = UDim2.new(1, -28, 0, 45)
        STitle.Position = UDim2.new(0, 14, 0, 5)
        STitle.BackgroundTransparency = 1
        STitle.Text = name
        STitle.TextColor3 = CurrentTheme.Accent
        STitle.Font = Enum.Font.GothamBold
        STitle.TextSize = 17
        STitle.TextXAlignment = Enum.TextXAlignment.Left
        STitle.Parent = Section

        local SContent = Instance.new("Frame")
        SContent.Size = UDim2.new(1, 0, 0, 0)
        SContent.Position = UDim2.new(0, 0, 0, 50)
        SContent.BackgroundTransparency = 1
        SContent.AutomaticSize = Enum.AutomaticSize.Y
        SContent.Parent = Section

        local SLayout = Instance.new("UIListLayout")
        SLayout.SortOrder = Enum.SortOrder.LayoutOrder
        SLayout.Padding = UDim.new(0, 8)
        SLayout.Parent = SContent
        
        local SPadding = Instance.new("UIPadding")
        SPadding.PaddingTop = UDim.new(0, 0)
        SPadding.PaddingBottom = UDim.new(0, 12)
        SPadding.PaddingLeft = UDim.new(0, 12)
        SPadding.PaddingRight = UDim.new(0, 12)
        SPadding.Parent = SContent

        -- Enhanced Button
        function Section:CreateButton(config)
            local Button = Instance.new("TextButton")
            Button.Size = UDim2.new(1, 0, 0, 42)
            Button.BackgroundColor3 = CurrentTheme.Tertiary
            Button.BorderSizePixel = 0
            Button.Text = ""
            Button.AutoButtonColor = false
            Button.Parent = SContent
            
            local BCorner = Instance.new("UICorner")
            BCorner.CornerRadius = UDim.new(0, 10)
            BCorner.Parent = Button

            local BGradient = Instance.new("UIGradient")
            BGradient.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, CurrentTheme.Tertiary),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(
                    math.clamp(CurrentTheme.Tertiary.R * 255 - 8, 0, 255),
                    math.clamp(CurrentTheme.Tertiary.G * 255 - 8, 0, 255),
                    math.clamp(CurrentTheme.Tertiary.B * 255 - 8, 0, 255)
                ))
            }
            BGradient.Rotation = 90
            BGradient.Parent = Button

            local BLabel = Instance.new("TextLabel")
            BLabel.Size = UDim2.new(1, -24, 1, 0)
            BLabel.Position = UDim2.new(0, 12, 0, 0)
            BLabel.BackgroundTransparency = 1
            BLabel.Text = config.Name or "Button"
            BLabel.TextColor3 = CurrentTheme.Text
            BLabel.Font = Enum.Font.GothamSemibold
            BLabel.TextSize = 15
            BLabel.TextXAlignment = Enum.TextXAlignment.Left
            BLabel.Parent = Button
            
            Button.MouseEnter:Connect(function()
                TweenService:Create(Button, AnimationPresets.Fast, {
                    BackgroundColor3 = CurrentTheme.Hover,
                    Size = UDim2.new(1, 0, 0, 44)
                }):Play()
                TweenService:Create(BLabel, AnimationPresets.Fast, {
                    TextColor3 = CurrentTheme.Accent
                }):Play()
            end)
            
            Button.MouseLeave:Connect(function()
                TweenService:Create(Button, AnimationPresets.Fast, {
                    BackgroundColor3 = CurrentTheme.Tertiary,
                    Size = UDim2.new(1, 0, 0, 42)
                }):Play()
                TweenService:Create(BLabel, AnimationPresets.Fast, {
                    TextColor3 = CurrentTheme.Text
                }):Play()
            end)
            
            Button.MouseButton1Click:Connect(function()
                -- Ripple effect
                local ripple = Instance.new("Frame")
                ripple.Size = UDim2.new(0, 0, 0, 0)
                ripple.Position = UDim2.new(0.5, 0, 0.5, 0)
                ripple.AnchorPoint = Vector2.new(0.5, 0.5)
                ripple.BackgroundColor3 = CurrentTheme.Accent
                ripple.BackgroundTransparency = 0.5
                ripple.BorderSizePixel = 0
                ripple.ZIndex = Button.ZIndex + 1
                ripple.Parent = Button
                
                local rippleCorner = Instance.new("UICorner")
                rippleCorner.CornerRadius = UDim.new(1, 0)
                rippleCorner.Parent = ripple
                
                TweenService:Create(ripple, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    Size = UDim2.new(2, 0, 2, 0),
                    BackgroundTransparency = 1
                }):Play()
                
                task.delay(0.5, function()
                    ripple:Destroy()
                end)
                
                if config.Callback then
                    pcall(config.Callback)
                end
            end)
            
            table.insert(Tab.Elements, {Name = config.Name, Type = "Button", Element = Button})
            return Button
        end

        -- Enhanced Toggle
        function Section:CreateToggle(config)
            local Toggle = {}
            local Frame = Instance.new("Frame")
            Frame.Size = UDim2.new(1, 0, 0, 42)
            Frame.BackgroundColor3 = CurrentTheme.Tertiary
            Frame.BorderSizePixel = 0
            Frame.Parent = SContent
            
            local FCorner = Instance.new("UICorner")
            FCorner.CornerRadius = UDim.new(0, 10)
            FCorner.Parent = Frame

            local FGradient = Instance.new("UIGradient")
            FGradient.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, CurrentTheme.Tertiary),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(
                    math.clamp(CurrentTheme.Tertiary.R * 255 - 8, 0, 255),
                    math.clamp(CurrentTheme.Tertiary.G * 255 - 8, 0, 255),
                    math.clamp(CurrentTheme.Tertiary.B * 255 - 8, 0, 255)
                ))
            }
            FGradient.Rotation = 90
            FGradient.Parent = Frame

            local Label = Instance.new("TextLabel")
            Label.Size = UDim2.new(1, -70, 1, 0)
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.BackgroundTransparency = 1
            Label.Text = config.Name or "Toggle"
            Label.TextColor3 = CurrentTheme.Text
            Label.Font = Enum.Font.GothamSemibold
            Label.TextSize = 15
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.Parent = Frame

            local TButton = Instance.new("TextButton")
            TButton.Size = UDim2.new(0, 48, 0, 24)
            TButton.Position = UDim2.new(1, -56, 0.5, -12)
            TButton.BackgroundColor3 = CurrentTheme.Background
            TButton.BorderSizePixel = 0
            TButton.Text = ""
            TButton.AutoButtonColor = false
            TButton.Parent = Frame
            
            local TCorner = Instance.new("UICorner")
            TCorner.CornerRadius = UDim.new(1, 0)
            TCorner.Parent = TButton

            local Indicator = Instance.new("Frame")
            Indicator.Size = UDim2.new(0, 20, 0, 20)
            Indicator.Position = UDim2.new(0, 2, 0.5, -10)
            Indicator.BackgroundColor3 = CurrentTheme.Error
            Indicator.BorderSizePixel = 0
            Indicator.Parent = TButton
            
            local ICorner = Instance.new("UICorner")
            ICorner.CornerRadius = UDim.new(1, 0)
            ICorner.Parent = Indicator

            local IGradient = Instance.new("UIGradient")
            IGradient.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, CurrentTheme.Error),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(
                    math.clamp(CurrentTheme.Error.R * 255 - 30, 0, 255),
                    math.clamp(CurrentTheme.Error.G * 255 - 30, 0, 255),
                    math.clamp(CurrentTheme.Error.B * 255 - 30, 0, 255)
                ))
            }
            IGradient.Rotation = 90
            IGradient.Parent = Indicator

            local value = config.CurrentValue or false
            if config.Flag and self.Flags[config.Flag] ~= nil then
                value = self.Flags[config.Flag]
            end

            local function update()
                TweenService:Create(Indicator, AnimationPresets.Smooth, {
                    Position = value and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 2, 0.5, -10),
                    BackgroundColor3 = value and CurrentTheme.Success or CurrentTheme.Error
                }):Play()
                
                TweenService:Create(TButton, AnimationPresets.Smooth, {
                    BackgroundColor3 = value and CurrentTheme.Accent or CurrentTheme.Background
                }):Play()
                
                TweenService:Create(Label, AnimationPresets.Fast, {
                    TextColor3 = value and CurrentTheme.Accent or CurrentTheme.Text
                }):Play()
                
                IGradient.Color = ColorSequence.new{
                    ColorSequenceKeypoint.new(0, value and CurrentTheme.Success or CurrentTheme.Error),
                    ColorSequenceKeypoint.new(1, Color3.fromRGB(
                        math.clamp((value and CurrentTheme.Success or CurrentTheme.Error).R * 255 - 30, 0, 255),
                        math.clamp((value and CurrentTheme.Success or CurrentTheme.Error).G * 255 - 30, 0, 255),
                        math.clamp((value and CurrentTheme.Success or CurrentTheme.Error).B * 255 - 30, 0, 255)
                    ))
                }
            end
            update()

            TButton.MouseButton1Click:Connect(function()
                value = not value
                update()
                if config.Flag then
                    Tab.Flags[config.Flag] = value
                    Tab:SaveConfig()
                end
                if config.Callback then
                    pcall(config.Callback, value)
                end
            end)

            function Toggle:Set(newValue)
                value = newValue
                update()
                if config.Flag then
                    Tab.Flags[config.Flag] = value
                    Tab:SaveConfig()
                end
            end

            table.insert(Tab.Elements, {Name = config.Name, Type = "Toggle", Element = Toggle})
            return Toggle
        end

        -- Enhanced Slider
        function Section:CreateSlider(config)
            local Slider = {}
            Slider.Frame = Instance.new("Frame")
            Slider.Frame.Size = UDim2.new(1, 0, 0, 58)
            Slider.Frame.BackgroundColor3 = CurrentTheme.Tertiary
            Slider.Frame.BorderSizePixel = 0
            Slider.Frame.Parent = SContent
            
            local SCorner = Instance.new("UICorner")
            SCorner.CornerRadius = UDim.new(0, 10)
            SCorner.Parent = Slider.Frame

            local SGradient = Instance.new("UIGradient")
            SGradient.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, CurrentTheme.Tertiary),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(
                    math.clamp(CurrentTheme.Tertiary.R * 255 - 8, 0, 255),
                    math.clamp(CurrentTheme.Tertiary.G * 255 - 8, 0, 255),
                    math.clamp(CurrentTheme.Tertiary.B * 255 - 8, 0, 255)
                ))
            }
            SGradient.Rotation = 90
            SGradient.Parent = Slider.Frame

            local Label = Instance.new("TextLabel")
            Label.Size = UDim2.new(1, -70, 0, 24)
            Label.Position = UDim2.new(0, 12, 0, 8)
            Label.BackgroundTransparency = 1
            Label.Text = config.Name or "Slider"
            Label.TextColor3 = CurrentTheme.Text
            Label.Font = Enum.Font.GothamSemibold
            Label.TextSize = 15
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.Parent = Slider.Frame

            local ValueLabel = Instance.new("TextLabel")
            ValueLabel.Size = UDim2.new(0, 60, 0, 24)
            ValueLabel.Position = UDim2.new(1, -68, 0, 8)
            ValueLabel.BackgroundTransparency = 1
            ValueLabel.TextColor3 = CurrentTheme.Accent
            ValueLabel.Font = Enum.Font.GothamBold
            ValueLabel.TextSize = 15
            ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
            ValueLabel.Parent = Slider.Frame

            local Bar = Instance.new("Frame")
            Bar.Size = UDim2.new(1, -24, 0, 6)
            Bar.Position = UDim2.new(0, 12, 1, -20)
            Bar.BackgroundColor3 = CurrentTheme.Background
            Bar.BorderSizePixel = 0
            Bar.Parent = Slider.Frame
            
            local BarCorner = Instance.new("UICorner")
            BarCorner.CornerRadius = UDim.new(1, 0)
            BarCorner.Parent = Bar

            local Fill = Instance.new("Frame")
            Fill.Size = UDim2.new(0, 0, 1, 0)
            Fill.BackgroundColor3 = CurrentTheme.Accent
            Fill.BorderSizePixel = 0
            Fill.Parent = Bar
            
            local FillCorner = Instance.new("UICorner")
            FillCorner.CornerRadius = UDim.new(1, 0)
            FillCorner.Parent = Fill

            local FillGradient = Instance.new("UIGradient")
            FillGradient.Color = CurrentTheme.AccentGradient
            FillGradient.Rotation = 0
            FillGradient.Parent = Fill

            -- Draggable circle
            local Circle = Instance.new("Frame")
            Circle.Size = UDim2.new(0, 16, 0, 16)
            Circle.Position = UDim2.new(0, -8, 0.5, -8)
            Circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            Circle.BorderSizePixel = 0
            Circle.ZIndex = 2
            Circle.Parent = Fill
            
            local CircleCorner = Instance.new("UICorner")
            CircleCorner.CornerRadius = UDim.new(1, 0)
            CircleCorner.Parent = Circle

            local CircleShadow = Instance.new("ImageLabel")
            CircleShadow.Size = UDim2.new(1, 8, 1, 8)
            CircleShadow.Position = UDim2.new(0, -4, 0, -4)
            CircleShadow.BackgroundTransparency = 1
            CircleShadow.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
            CircleShadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
            CircleShadow.ImageTransparency = 0.7
            CircleShadow.ZIndex = 1
            CircleShadow.Parent = Circle

            local min = config.Range and config.Range[1] or config.Min or 0
            local max = config.Range and config.Range[2] or config.Max or 100
            local increment = config.Increment or 1
            local value = config.CurrentValue or min
            
            if config.Flag and Tab.Window.Flags[config.Flag] ~= nil then
                value = self.Flags[config.Flag]
            end

            local function update(newValue)
                value = math.clamp(math.floor((newValue - min) / increment + 0.5) * increment + min, min, max)
                local percent = (value - min) / (max - min)
                
                TweenService:Create(Fill, AnimationPresets.Fast, {
                    Size = UDim2.new(percent, 0, 1, 0)
                }):Play()
                
                ValueLabel.Text = tostring(value) .. (config.Suffix or "")
                
                if config.Flag then
                    Tab.Flags[config.Flag] = value
                    Tab:SaveConfig()
                end
                if config.Callback then
                    pcall(config.Callback, value)
                end
            end
            update(value)

            local sliding = false
            Bar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    sliding = true
                    TweenService:Create(Circle, AnimationPresets.Fast, {
                        Size = UDim2.new(0, 20, 0, 20),
                        Position = UDim2.new(0, -10, 0.5, -10)
                    }):Play()
                    
                    local relativeX = math.clamp((input.Position.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1)
                    local newValue = min + (max - min) * relativeX
                    update(newValue)
                end
            end)
            
            Bar.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    sliding = false
                    TweenService:Create(Circle, AnimationPresets.Fast, {
                        Size = UDim2.new(0, 16, 0, 16),
                        Position = UDim2.new(0, -8, 0.5, -8)
                    }):Play()
                end
            end)
            
            UserInputService.InputChanged:Connect(function(input)
                if sliding and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    local relativeX = math.clamp((input.Position.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1)
                    local newValue = min + (max - min) * relativeX
                    update(newValue)
                end
            end)

            function Slider:Set(newValue)
                update(newValue)
            end

            table.insert(Tab.Elements, {Name = config.Name, Type = "Slider", Element = Slider})
            return Slider
        end

        -- Enhanced Label
        function Section:CreateLabel(text)
            local Label = Instance.new("TextLabel")
            Label.Size = UDim2.new(1, 0, 0, 36)
            Label.BackgroundColor3 = CurrentTheme.Tertiary
            Label.BorderSizePixel = 0
            Label.Text = text or "Label"
            Label.TextColor3 = CurrentTheme.Text
            Label.Font = Enum.Font.Gotham
            Label.TextSize = 14
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.TextWrapped = true
            Label.Parent = SContent
            
            local LCorner = Instance.new("UICorner")
            LCorner.CornerRadius = UDim.new(0, 10)
            LCorner.Parent = Label
            
            local LPadding = Instance.new("UIPadding")
            LPadding.PaddingLeft = UDim.new(0, 12)
            LPadding.PaddingRight = UDim.new(0, 12)
            LPadding.Parent = Label

            local LGradient = Instance.new("UIGradient")
            LGradient.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, CurrentTheme.Tertiary),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(
                    math.clamp(CurrentTheme.Tertiary.R * 255 - 8, 0, 255),
                    math.clamp(CurrentTheme.Tertiary.G * 255 - 8, 0, 255),
                    math.clamp(CurrentTheme.Tertiary.B * 255 - 8, 0, 255)
                ))
            }
            LGradient.Rotation = 90
            LGradient.Parent = Label
            
            function Label:Set(newText)
                Label.Text = newText
            end
            
            return Label
        end

        -- Enhanced Divider
        function Section:CreateDivider()
            local Divider = Instance.new("Frame")
            Divider.Size = UDim2.new(1, 0, 0, 1)
            Divider.BackgroundColor3 = CurrentTheme.Disabled
            Divider.BackgroundTransparency = 0.7
            Divider.BorderSizePixel = 0
            Divider.Parent = SContent
            
            local DGradient = Instance.new("UIGradient")
            DGradient.Transparency = NumberSequence.new{
                NumberSequenceKeypoint.new(0, 1),
                NumberSequenceKeypoint.new(0.5, 0),
                NumberSequenceKeypoint.new(1, 1)
            }
            DGradient.Parent = Divider
        end

        return Section
    end

    return Tab
end

-- SaveConfig
function bxScript:SaveConfig()
    if self.ConfigurationSaving and self.ConfigurationSaving.Enabled then
        local folder = self.ConfigurationSaving.FolderName
        local file = folder .. "/" .. self.ConfigurationSaving.FileName
        
        local success = pcall(function()
            if not isfolder(folder) then
                makefolder(folder)
            end
            writefile(file, HttpService:JSONEncode(self.Flags))
        end)
        
        if not success then
            warn("Failed to save configuration")
        end
    end
end

-- LoadConfig
function bxScript:LoadConfig()
    if self.ConfigurationSaving and self.ConfigurationSaving.Enabled then
        local folder = self.ConfigurationSaving.FolderName
        local file = folder .. "/" .. self.ConfigurationSaving.FileName
        
        if isfile(file) then
            local success, loaded = pcall(function()
                return HttpService:JSONDecode(readfile(file))
            end)
            
            if success and type(loaded) == "table" then
                self.Flags = loaded
                return true
            end
        end
    end
    return false
end

return bxScript
